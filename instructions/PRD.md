# PRD: Dreamy App

## 1. Executive Summary

Dreamy is a cross-platform personal wellness application that allows users to record their dreams via text or voice. By leveraging Large Language Models (LLMs), the app provides immediate psychological interpretation, mood tracking, and recurring pattern recognition. The goal is to help users understand their subconscious and improve sleep mindfulness.

---

## 2. Technical Architecture

### 2.1 Technology Stack

- **Frontend**: React Native with Expo (Managed Workflow).
- **Web Support**: React Native Web (enabled via Expo).
- **Navigation**: Expo Router (File-based routing).
- **Authentication**: Supabase Auth (Google OAuth provider + Native/Web redirect handling).
- **Database**: Supabase PostgreSQL.
- **AI Service**: OpenAI API (Chat Completions Endpoint).
- **Voice/Audio**:
  - **Option A (Native Dictation)**: Standard keyboard dictation.
  - **Option B (App Feature)**: `expo-av` for recording + OpenAI Whisper API for transcription.

### 2.2 Security & Privacy

- **RLS (Row Level Security)**: All database queries must enable RLS. Users can only SELECT, INSERT, UPDATE, or DELETE rows where `auth.uid() = user_id`.
- **API Key Management**: OpenAI API keys must not be stored in the React Native client code. All AI requests should be proxied through a Supabase Edge Function or a secure backend API.

---

## 3. Database Schema

### 3.1 Table: `profiles`

Automatic table linked to `auth.users` via Supabase triggers.

| Column Name | Type | Description |
| :--- | :--- | :--- |
| `id` | UUID | Primary Key, References `auth.users` |
| `email` | Text | User email |
| `full_name` | Text | Display name from Google Auth |
| `avatar_url` | Text | Profile picture URL |
| `updated_at` | Timestamp | Last update time |

### 3.2 Table: `dreams`

Stores the raw user input and the AI analysis.

| Column Name | Type | Description |
| :--- | :--- | :--- |
| `id` | UUID | Primary Key (default `gen_random_uuid()`) |
| `user_id` | UUID | Foreign Key -> `profiles.id` |
| `title` | Text | Generated by AI or User Input |
| `content` | Text | The raw text of the dream description |
| `interpretation` | Text | The main analysis from the AI |
| `mood` | Text | Single word mood (e.g., "Anxious", "Magical") |
| `keywords` | Array(Text) | Searchable tags (e.g., ["flying", "ocean"]) |
| `is_lucid` | Boolean | Flag for lucid dreams (default `false`) |
| `created_at` | Timestamp | Date recorded |
| `dream_date` | Date | Actual date of the dream |

---

## 4. Product Milestones

### ðŸŸ¢ v0.1: Authentication & Shell

**Objective**: Secure login and environment setup.

- **Features**:
  - Landing Screen: "Login with Google" button.
  - Auth Handler: Setup Supabase Auth listeners to handle session state (LoggedIn vs. LoggedOut).
  - Home Screen (Empty): Placeholder screen visible only after authentication.
  - Logout: Functionality to clear session.
- **Acceptance Criteria**:
  - User can sign in with Google on Web.
  - User can sign in with Google on iOS Simulator.
  - User data is visible in the Supabase `auth.users` table.

### ðŸ”µ v0.2: Database Foundation

**Objective**: Data persistence (CRUD).

- **Features**:
  - List View: Display a list of dreams fetched from Supabase.
  - Create View (Manual): A form with a Text Input for "Dream Content" and a "Save" button.
  - Supabase RLS: Policies applied so users only see their own data.
- **Acceptance Criteria**:
  - User can type text and save it.
  - The saved item immediately appears in the List View.
  - Data persists after app restart.

### ðŸŸ¡ v1.0: Core AI & Voice (MVP)

**Objective**: The primary value loop (Input -> AI -> Insight).

- **Features**:
  - Voice Input: Integration of dictation or audio recording to capture dream descriptions hands-free.
  - AI Integration: Connection to OpenAI.
  - Dream Analysis UI: A detailed view showing the Dream Text alongside the AI Interpretation.
- **AI Logic**:
  - Trigger AI upon saving a new dream.
  - Extract: Title, Interpretation, Mood, and Keywords.
- **Acceptance Criteria**:
  - User speaks/types a dream.
  - Within 5 seconds, an interpretation appears.
  - Database entry is updated with the analysis.

### ðŸŸ  v1.5: Insights & Aggregation

**Objective**: Long-term value and retention.

- **Features**:
  - Dashboard Tab: Visual statistics.
  - Pattern Recognition: "You have dreamt about [Topic] 3 times this month."
  - Mood Heatmap: A visual calendar showing the dominant mood of dreams per day.
- **Acceptance Criteria**:
  - Implementation of a charting library (e.g., `react-native-chart-kit` or `victory-native`).
  - Aggregated SQL queries to count tags and moods.

### ðŸŸ£ v2.0+: Advanced Modules

**Objective**: Feature expansion.

- **Lucid Dreaming Suite**:
  - Reality Check push notifications (customizable intervals).
  - Tutorial content/guides.
- **Astrological Integration**:
  - Input field for Birth Date/Time.
  - Updated AI System Prompt to include astrological context in interpretations.
- **Search & Filter**: Search dreams by keyword or date range.

---

## 5. User Flows (v1.0)

### Flow: Recording a Dream

1. **Open App**: User lands on the Dashboard.
2. **Action**: User taps the floating action button (+).
3. **Input**:
    - User taps "Mic" icon and speaks description.
    - App converts speech to text.
4. **Refine**: User reviews text, corrects errors, and taps "Analyze".
5. **Processing**:
    - UI shows a loading state ("Analyzing your subconscious...").
    - Backend sends text to LLM.
6. **Result**:
    - App transitions to the Dream Detail View.
    - Displays the generated Title, the Interpretation, and the Mood tag.
    - Dream is saved to the history.

---

## 6. AI Prompts (System Instructions)

**Model**: GPT-4o-mini (Recommended for speed/cost)

**System Prompt**:

```text
You are an empathetic and insightful dream analyst utilizing Jungian psychology and modern symbolism.

Input: User's dream description.

Output: A JSON object with the following structure:
{
  "title": "A short, creative title for the dream",
  "interpretation": "A 3-4 sentence psychological analysis of what the dream might mean regarding the user's waking life.",
  "mood": "One word describing the emotional tone (e.g., Anxious, Peaceful, Confusing)",
  "keywords": ["tag1", "tag2", "tag3"]
}

Do not include markdown formatting like ```json. Return only the raw JSON.
```
